<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafuc.mapper.UserMapper">
    
    <resultMap id="UserResultMap" type="com.cafuc.pojo.User">
        <id property="userId" column="user_id"/>
        <result property="userName" column="user_name"/>
        <result property="userPwd" column="user_pwd"/>
        <result property="userEmail" column="user_email"/>
        <result property="userPhone" column="user_phone"/>
        <result property="userSex" column="user_sex"/>
        <result property="userAge" column="user_age"/>
        <result property="createTime" column="create_time"/>
    </resultMap>
    
    <!-- 根据用户名和密码查询用户 -->
    <select id="findUserByNameAndPwd" resultMap="UserResultMap">
        SELECT * FROM user
        WHERE user_name = #{userName} AND user_pwd = #{userPwd}
    </select>
    
    <!-- 根据用户名查询用户 -->
    <select id="findUserByName" resultMap="UserResultMap">
        SELECT * FROM user WHERE user_name = #{userName}
    </select>
    
    <!-- 根据ID查询用户 -->
    <select id="findUserById" resultMap="UserResultMap">
        SELECT * FROM user WHERE user_id = #{userId}
    </select>
    
    <!-- 添加用户 -->
    <insert id="addUser" parameterType="com.cafuc.pojo.User">
        INSERT INTO user (user_id, user_name, user_pwd, user_email, user_phone, user_sex, user_age, create_time)
        VALUES (#{userId}, #{userName}, #{userPwd}, #{userEmail}, #{userPhone}, #{userSex}, #{userAge}, #{createTime})
    </insert>
    
    <!-- 更新用户信息 -->
    <update id="updateUser" parameterType="com.cafuc.pojo.User">
        UPDATE user
        <set>
            <if test="userName != null and userName != ''">user_name = #{userName},</if>
            <if test="userPwd != null and userPwd != ''">user_pwd = #{userPwd},</if>
            <if test="userEmail != null and userEmail != ''">user_email = #{userEmail},</if>
            <if test="userPhone != null and userPhone != ''">user_phone = #{userPhone},</if>
            <if test="userSex != null and userSex != ''">user_sex = #{userSex},</if>
            <if test="userAge != null">user_age = #{userAge},</if>
        </set>
        WHERE user_id = #{userId}
    </update>
    
    <!-- 删除用户 -->
    <delete id="deleteUser">
        DELETE FROM user WHERE user_id = #{userId}
    </delete>
    
    <!-- 查询所有用户 -->
    <select id="getAllUsers" resultMap="UserResultMap">
        SELECT * FROM user ORDER BY create_time DESC
    </select>
    
    <!-- 分页查询用户 -->
    <select id="getUsersByPage" resultMap="UserResultMap">
        SELECT * FROM user ORDER BY create_time DESC
        LIMIT #{start}, #{pageSize}
    </select>
    
    <!-- 获取用户总数 -->
    <select id="getUserCount" resultType="int">
        SELECT COUNT(*) FROM user
    </select>
    
</mapper>
